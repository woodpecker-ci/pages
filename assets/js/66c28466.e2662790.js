"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([["8307"],{65436:function(e,n,o){o.r(n),o.d(n,{default:()=>u,frontMatter:()=>c,metadata:()=>s,assets:()=>d,toc:()=>a,contentTitle:()=>r});var s=JSON.parse('{"id":"administration/backends/kubernetes","title":"Kubernetes backend","description":"Kubernetes support is still experimental and not all pipeline features are fully supported yet.","source":"@site/versioned_docs/version-1.0/30-administration/22-backends/40-kubernetes.md","sourceDirName":"30-administration/22-backends","slug":"/administration/backends/kubernetes","permalink":"/docs/1.0/administration/backends/kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/versioned_docs/version-1.0/30-administration/22-backends/40-kubernetes.md","tags":[],"version":"1.0","sidebarPosition":40,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"SSH backend","permalink":"/docs/1.0/administration/backends/ssh"},"next":{"title":"Databases","permalink":"/docs/1.0/administration/database"}}'),t=o("52676"),i=o("23663");let c={},r="Kubernetes backend",d={},a=[{value:"Configuration",id:"configuration",level:2},{value:"<code>WOODPECKER_BACKEND_K8S_NAMESPACE</code>",id:"woodpecker_backend_k8s_namespace",level:3},{value:"<code>WOODPECKER_BACKEND_K8S_VOLUME_SIZE</code>",id:"woodpecker_backend_k8s_volume_size",level:3},{value:"<code>WOODPECKER_BACKEND_K8S_STORAGE_CLASS</code>",id:"woodpecker_backend_k8s_storage_class",level:3},{value:"<code>WOODPECKER_BACKEND_K8S_STORAGE_RWX</code>",id:"woodpecker_backend_k8s_storage_rwx",level:3},{value:"<code>WOODPECKER_BACKEND_K8S_POD_LABELS</code>",id:"woodpecker_backend_k8s_pod_labels",level:3},{value:"<code>WOODPECKER_BACKEND_K8S_POD_ANNOTATIONS</code>",id:"woodpecker_backend_k8s_pod_annotations",level:3},{value:"Job specific configuration",id:"job-specific-configuration",level:2},{value:"Resources",id:"resources",level:3},{value:"serviceAccountName",id:"serviceaccountname",level:3},{value:"nodeSelector",id:"nodeselector",level:3}];function l(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"kubernetes-backend",children:"Kubernetes backend"})}),"\n",(0,t.jsxs)(n.admonition,{type:"caution",children:[(0,t.jsx)(n.p,{children:"Kubernetes support is still experimental and not all pipeline features are fully supported yet."}),(0,t.jsxs)(n.p,{children:["Check the ",(0,t.jsx)(n.a,{href:"https://github.com/woodpecker-ci/woodpecker/issues/1513",children:"current state"})]})]}),"\n",(0,t.jsx)(n.p,{children:"The kubernetes backend executes each step inside a newly created pod. A PVC is also created for the lifetime of the pipeline, for transferring files between steps."}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"woodpecker_backend_k8s_namespace",children:(0,t.jsx)(n.code,{children:"WOODPECKER_BACKEND_K8S_NAMESPACE"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Default: ",(0,t.jsx)(n.code,{children:"woodpecker"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The namespace to create worker pods in."}),"\n",(0,t.jsx)(n.h3,{id:"woodpecker_backend_k8s_volume_size",children:(0,t.jsx)(n.code,{children:"WOODPECKER_BACKEND_K8S_VOLUME_SIZE"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Default: ",(0,t.jsx)(n.code,{children:"10G"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The volume size of the pipeline volume."}),"\n",(0,t.jsx)(n.h3,{id:"woodpecker_backend_k8s_storage_class",children:(0,t.jsx)(n.code,{children:"WOODPECKER_BACKEND_K8S_STORAGE_CLASS"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Default: empty"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The storage class to use for the pipeline volume."}),"\n",(0,t.jsx)(n.h3,{id:"woodpecker_backend_k8s_storage_rwx",children:(0,t.jsx)(n.code,{children:"WOODPECKER_BACKEND_K8S_STORAGE_RWX"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Default: ",(0,t.jsx)(n.code,{children:"true"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Determines if ",(0,t.jsx)(n.code,{children:"RWX"})," should be used for the pipeline volume's ",(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes",children:"access mode"}),". If false, ",(0,t.jsx)(n.code,{children:"RWO"})," is used instead."]}),"\n",(0,t.jsx)(n.h3,{id:"woodpecker_backend_k8s_pod_labels",children:(0,t.jsx)(n.code,{children:"WOODPECKER_BACKEND_K8S_POD_LABELS"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Default: empty"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Additional labels to apply to worker pods. Must be a YAML object, e.g. ",(0,t.jsx)(n.code,{children:'{"example.com/test-label":"test-value"}'}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"woodpecker_backend_k8s_pod_annotations",children:(0,t.jsx)(n.code,{children:"WOODPECKER_BACKEND_K8S_POD_ANNOTATIONS"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Default: empty"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Additional annotations to apply to worker pods. Must be a YAML object, e.g. ",(0,t.jsx)(n.code,{children:'{"example.com/test-annotation":"test-value"}'}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"job-specific-configuration",children:"Job specific configuration"}),"\n",(0,t.jsx)(n.h3,{id:"resources",children:"Resources"}),"\n",(0,t.jsxs)(n.p,{children:["The kubernetes backend also allows for specifying requests and limits on a per-step basic, most commonly for CPU and memory.\nSee the ",(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/",children:"kubernetes documentation"})," for more information on using resources."]}),"\n",(0,t.jsx)(n.h3,{id:"serviceaccountname",children:"serviceAccountName"}),"\n",(0,t.jsxs)(n.p,{children:["Specify the name of the ServiceAccount which the build pod will mount. This serviceAccount must be created externally.\nSee the ",(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/security/service-accounts/",children:"kubernetes documentation"})," for more information on using serviceAccounts."]}),"\n",(0,t.jsx)(n.h3,{id:"nodeselector",children:"nodeSelector"}),"\n",(0,t.jsxs)(n.p,{children:['Specify the label which is used to select the node where the job should be executed. Labels defined here will be appended to a list already containing "kubernetes.io/arch".\nBy default the pod will use "kubernetes.io/arch" inferred from top-level "platform" setting which is deducted from the agents\' environment variable CI_SYSTEM_PLATFORM. To overwrite this, you need to specify this label in the nodeSelector section.\nSee the ',(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector",children:"kubernetes documentation"})," for more information on using nodeSelector."]}),"\n",(0,t.jsx)(n.p,{children:"Example pipeline configuration:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"steps:\n  build:\n    image: golang\n    commands:\n      - go get\n      - go build\n      - go test\n    backend_options:\n      kubernetes:\n        serviceAccountName: 'my-service-account'\n        resources:\n          requests:\n            memory: 128Mi\n            cpu: 1000m\n          limits:\n            memory: 256Mi\n        nodeSelector:\n          beta.kubernetes.io/instance-type: p3.8xlarge\n"})})]})}function u(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},23663:function(e,n,o){o.d(n,{Z:function(){return r},a:function(){return c}});var s=o(75271);let t={},i=s.createContext(t);function c(e){let n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);