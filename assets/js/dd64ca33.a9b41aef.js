"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([["6024"],{27151:function(e,n,o){o.r(n),o.d(n,{default:()=>u,frontMatter:()=>s,metadata:()=>t,assets:()=>a,toc:()=>d,contentTitle:()=>c});var t=JSON.parse('{"id":"administration/prometheus","title":"Prometheus","description":"Woodpecker is compatible with Prometheus and exposes a /metrics endpoint. Please note that access to the metrics endpoint is restricted and requires an authorization token with administrative privileges.","source":"@site/versioned_docs/version-1.0/30-administration/90-prometheus.md","sourceDirName":"30-administration","slug":"/administration/prometheus","permalink":"/docs/1.0/administration/prometheus","draft":false,"unlisted":false,"editUrl":"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/versioned_docs/version-1.0/30-administration/90-prometheus.md","tags":[],"version":"1.0","sidebarPosition":90,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Kubernetes","permalink":"/docs/1.0/administration/kubernetes"},"next":{"title":"External Configuration API","permalink":"/docs/1.0/administration/external-configuration-api"}}'),r=o("96773"),i=o("24027");let s={},c="Prometheus",a={},d=[{value:"Authorization",id:"authorization",level:2},{value:"Unauthenticated Access",id:"unauthenticated-access",level:2},{value:"Metric Reference",id:"metric-reference",level:2}];function p(e){let n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"prometheus",children:"Prometheus"})}),"\n",(0,r.jsxs)(n.p,{children:["Woodpecker is compatible with Prometheus and exposes a ",(0,r.jsx)(n.code,{children:"/metrics"})," endpoint. Please note that access to the metrics endpoint is restricted and requires an authorization token with administrative privileges."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"global:\n  scrape_interval: 60s\n\nscrape_configs:\n  - job_name: 'woodpecker'\n    bearer_token: dummyToken...\n\n    static_configs:\n      - targets: ['woodpecker.domain.com']\n"})}),"\n",(0,r.jsx)(n.h2,{id:"authorization",children:"Authorization"}),"\n",(0,r.jsx)(n.p,{children:"An administrator will need to generate a user API token and configure in the Prometheus configuration file as a bearer token. Please see the following example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:"global:\n  scrape_interval: 60s\n\nscrape_configs:\n  - job_name: 'woodpecker'\n+   bearer_token: dummyToken...\n\n    static_configs:\n       - targets: ['woodpecker.domain.com']\n"})}),"\n",(0,r.jsx)(n.h2,{id:"unauthenticated-access",children:"Unauthenticated Access"}),"\n",(0,r.jsxs)(n.p,{children:["Alternatively, the unprotected ",(0,r.jsx)(n.code,{children:"/metrics"})," endpoint might be exposed on the internal port. (Port is configurable via the ",(0,r.jsx)(n.code,{children:"WOODPECKER_METRICS_SERVER_ADDR"})," environment variable, e.g. ",(0,r.jsx)(n.code,{children:":9001"}),".)"]}),"\n",(0,r.jsx)(n.h2,{id:"metric-reference",children:"Metric Reference"}),"\n",(0,r.jsx)(n.p,{children:"List of Prometheus metrics specific to Woodpecker:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'# HELP woodpecker_pipeline_count Pipeline count.\n# TYPE woodpecker_pipeline_count counter\nwoodpecker_build_count{branch="master",pipeline="total",repo="woodpecker-ci/woodpecker",status="success"} 3\nwoodpecker_build_count{branch="mkdocs",pipeline="total",repo="woodpecker-ci/woodpecker",status="success"} 3\n# HELP woodpecker_pipeline_time Build time.\n# TYPE woodpecker_pipeline_time gauge\nwoodpecker_build_time{branch="master",pipeline="total",repo="woodpecker-ci/woodpecker",status="success"} 116\nwoodpecker_build_time{branch="mkdocs",pipeline="total",repo="woodpecker-ci/woodpecker",status="success"} 155\n# HELP woodpecker_pipeline_total_count Total number of builds.\n# TYPE woodpecker_pipeline_total_count gauge\nwoodpecker_build_total_count 1025\n# HELP woodpecker_pending_steps Total number of pending pipeline steps.\n# TYPE woodpecker_pending_steps gauge\nwoodpecker_pending_steps 0\n# HELP woodpecker_repo_count Total number of repos.\n# TYPE woodpecker_repo_count gauge\nwoodpecker_repo_count 9\n# HELP woodpecker_running_steps Total number of running pipeline steps.\n# TYPE woodpecker_running_steps gauge\nwoodpecker_running_steps 0\n# HELP woodpecker_user_count Total number of users.\n# TYPE woodpecker_user_count gauge\nwoodpecker_user_count 1\n# HELP woodpecker_waiting_steps Total number of pipeline waiting on deps.\n# TYPE woodpecker_waiting_steps gauge\nwoodpecker_waiting_steps 0\n# HELP woodpecker_worker_count Total number of workers.\n# TYPE woodpecker_worker_count gauge\nwoodpecker_worker_count 4\n'})})]})}function u(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},24027:function(e,n,o){o.d(n,{Z:function(){return c},a:function(){return s}});var t=o(41699);let r={},i=t.createContext(r);function s(e){let n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);