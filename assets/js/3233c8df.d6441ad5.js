"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([["9784"],{48186:function(e,n,a){a.r(n),a.d(n,{default:()=>d,frontMatter:()=>r,metadata:()=>i,assets:()=>s,toc:()=>m,contentTitle:()=>l});var i=JSON.parse('{"id":"usage/matrix-workflows","title":"Matrix workflows","description":"Woodpecker has integrated support for matrix workflows. Woodpecker executes a separate workflow for each combination in the matrix, allowing you to build and test against multiple configurations.","source":"@site/docs/20-usage/30-matrix-workflows.md","sourceDirName":"20-usage","slug":"/usage/matrix-workflows","permalink":"/docs/next/usage/matrix-workflows","draft":false,"unlisted":false,"editUrl":"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/docs/20-usage/30-matrix-workflows.md","tags":[],"version":"current","sidebarPosition":30,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Workflows","permalink":"/docs/next/usage/workflows"},"next":{"title":"Secrets","permalink":"/docs/next/usage/secrets"}}'),t=a("52676"),o=a("23663");let r={},l="Matrix workflows",s={},m=[{value:"Interpolation",id:"interpolation",level:2},{value:"Examples",id:"examples",level:2},{value:"Example matrix pipeline based on Docker image tag",id:"example-matrix-pipeline-based-on-docker-image-tag",level:3},{value:"Example matrix pipeline based on container image",id:"example-matrix-pipeline-based-on-container-image",level:3},{value:"Example matrix pipeline using multiple platforms",id:"example-matrix-pipeline-using-multiple-platforms",level:3}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"matrix-workflows",children:"Matrix workflows"})}),"\n",(0,t.jsx)(n.p,{children:"Woodpecker has integrated support for matrix workflows. Woodpecker executes a separate workflow for each combination in the matrix, allowing you to build and test against multiple configurations."}),"\n",(0,t.jsx)(n.p,{children:"Example matrix definition:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"matrix:\n  GO_VERSION:\n    - 1.4\n    - 1.3\n  REDIS_VERSION:\n    - 2.6\n    - 2.8\n    - 3.0\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example matrix definition containing only specific combinations:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"matrix:\n  include:\n    - GO_VERSION: 1.4\n      REDIS_VERSION: 2.8\n    - GO_VERSION: 1.5\n      REDIS_VERSION: 2.8\n    - GO_VERSION: 1.6\n      REDIS_VERSION: 3.0\n"})}),"\n",(0,t.jsx)(n.h2,{id:"interpolation",children:"Interpolation"}),"\n",(0,t.jsxs)(n.p,{children:["Matrix variables are interpolated in the YAML using the ",(0,t.jsx)(n.code,{children:"${VARIABLE}"})," syntax, before the YAML is parsed. This is an example YAML file before interpolating matrix parameters:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"matrix:\n  GO_VERSION:\n    - 1.4\n    - 1.3\n  DATABASE:\n    - mysql:8\n    - mysql:5\n    - mariadb:10.1\n\nsteps:\n  - name: build\n    image: golang:${GO_VERSION}\n    commands:\n      - go get\n      - go build\n      - go test\n\nservices:\n  - name: database\n    image: ${DATABASE}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example YAML file after injecting the matrix parameters:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",children:" steps:\n   - name: build\n-    image: golang:${GO_VERSION}\n+    image: golang:1.4\n     commands:\n       - go get\n       - go build\n       - go test\n+    environment:\n+      - GO_VERSION=1.4\n+      - DATABASE=mysql:8\n\n services:\n   - name: database\n-    image: ${DATABASE}\n+    image: mysql:8\n"})}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.h3,{id:"example-matrix-pipeline-based-on-docker-image-tag",children:"Example matrix pipeline based on Docker image tag"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"matrix:\n  TAG:\n    - 1.7\n    - 1.8\n    - latest\n\nsteps:\n  - name: build\n    image: golang:${TAG}\n    commands:\n      - go build\n      - go test\n"})}),"\n",(0,t.jsx)(n.h3,{id:"example-matrix-pipeline-based-on-container-image",children:"Example matrix pipeline based on container image"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"matrix:\n  IMAGE:\n    - golang:1.7\n    - golang:1.8\n    - golang:latest\n\nsteps:\n  - name: build\n    image: ${IMAGE}\n    commands:\n      - go build\n      - go test\n"})}),"\n",(0,t.jsx)(n.h3,{id:"example-matrix-pipeline-using-multiple-platforms",children:"Example matrix pipeline using multiple platforms"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'matrix:\n  platform:\n    - linux/amd64\n    - linux/arm64\n\nlabels:\n  platform: ${platform}\n\nsteps:\n  - name: test\n    image: alpine\n    commands:\n      - echo "I am running on ${platform}"\n\n  - name: test-arm-only\n    image: alpine\n    commands:\n      - echo "I am running on ${platform}"\n      - echo "Arm is cool!"\n    when:\n      platform: linux/arm*\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["If you want to control the architecture of a pipeline on a Kubernetes runner, see ",(0,t.jsx)(n.a,{href:"/docs/next/administration/backends/kubernetes#node-selector",children:"the nodeSelector documentation of the Kubernetes backend"}),"."]})})]})}function d(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},23663:function(e,n,a){a.d(n,{Z:function(){return l},a:function(){return r}});var i=a(75271);let t={},o=i.createContext(t);function r(e){let n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);