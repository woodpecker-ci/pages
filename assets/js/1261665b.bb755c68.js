/*! For license information please see 1261665b.bb755c68.js.LICENSE.txt */
"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([[1324],{49988:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var r=t(2488),o=t(37052);const i={},s="Bitbucket Server",c={id:"administration/vcs/bitbucket_server",title:"Bitbucket Server",description:"Woodpecker comes with experimental support for Bitbucket Server, formerly known as Atlassian Stash. To enable Bitbucket Server you should configure the Woodpecker container using the following environment variables:",source:"@site/versioned_docs/version-0.15/30-administration/11-vcs/60-bitbucket_server.md",sourceDirName:"30-administration/11-vcs",slug:"/administration/vcs/bitbucket_server",permalink:"/docs/0.15/administration/vcs/bitbucket_server",draft:!1,unlisted:!1,editUrl:"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/versioned_docs/version-0.15/30-administration/11-vcs/60-bitbucket_server.md",tags:[],version:"0.15",sidebarPosition:60,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Bitbucket",permalink:"/docs/0.15/administration/vcs/bitbucket"},next:{title:"Gogs",permalink:"/docs/0.15/administration/vcs/gogs"}},a={},d=[{value:"Private Key File",id:"private-key-file",level:2},{value:"Service Account",id:"service-account",level:2},{value:"Registration",id:"registration",level:2},{value:"Configuration",id:"configuration",level:2},{value:"<code>WOODPECKER_STASH</code>",id:"woodpecker_stash",level:3},{value:"<code>WOODPECKER_STASH_URL</code>",id:"woodpecker_stash_url",level:3},{value:"<code>WOODPECKER_STASH_CONSUMER_KEY</code>",id:"woodpecker_stash_consumer_key",level:3},{value:"<code>WOODPECKER_STASH_CONSUMER_RSA</code>",id:"woodpecker_stash_consumer_rsa",level:3},{value:"<code>WOODPECKER_STASH_CONSUMER_RSA_STRING</code>",id:"woodpecker_stash_consumer_rsa_string",level:3},{value:"<code>WOODPECKER_STASH_GIT_USERNAME</code>",id:"woodpecker_stash_git_username",level:3},{value:"<code>WOODPECKER_STASH_GIT_PASSWORD</code>",id:"woodpecker_stash_git_password",level:3},{value:"<code>WOODPECKER_STASH_SKIP_VERIFY</code>",id:"woodpecker_stash_skip_verify",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"bitbucket-server",children:"Bitbucket Server"}),"\n",(0,r.jsx)(n.p,{children:"Woodpecker comes with experimental support for Bitbucket Server, formerly known as Atlassian Stash. To enable Bitbucket Server you should configure the Woodpecker container using the following environment variables:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:"# docker-compose.yml\nversion: '3'\n\nservices:\n  woodpecker-server:\n    [...]\n    environment:\n      - [...]\n+     - WOODPECKER_STASH=true\n+     - WOODPECKER_STASH_GIT_USERNAME=foo\n+     - WOODPECKER_STASH_GIT_PASSWORD=bar\n+     - WOODPECKER_STASH_CONSUMER_KEY=95c0282573633eb25e82\n+     - WOODPECKER_STASH_CONSUMER_RSA=/etc/bitbucket/key.pem\n+     - WOODPECKER_STASH_URL=http://stash.mycompany.com\n    volumes:\n+     - /path/to/key.pem:/path/to/key.pem\n\n  woodpecker-agent:\n    [...]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"private-key-file",children:"Private Key File"}),"\n",(0,r.jsx)(n.p,{children:"The OAuth process in Bitbucket server requires a private and a public RSA certificate. This is how you create the private RSA certificate."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nohighlight",children:"openssl genrsa -out /etc/bitbucket/key.pem 1024\n"})}),"\n",(0,r.jsxs)(n.p,{children:["This stores the private RSA certificate in ",(0,r.jsx)(n.code,{children:"key.pem"}),". The next command generates the public RSA certificate and stores it in ",(0,r.jsx)(n.code,{children:"key.pub"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nohighlight",children:"openssl rsa -in /etc/bitbucket/key.pem -pubout >> /etc/bitbucket/key.pub\n"})}),"\n",(0,r.jsx)(n.p,{children:"Please note that the private key file can be mounted into your Woodpecker container at runtime or as an environment variable"}),"\n",(0,r.jsx)(n.p,{children:"Private key file mounted into your Woodpecker container at runtime as a volume."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:"# docker-compose.yml\nversion: '3'\n\nservices:\n  woodpecker-server:\n    [...]\n    environment:\n      - [...]\n      - WOODPECKER_STASH=true\n      - WOODPECKER_STASH_GIT_USERNAME=foo\n      - WOODPECKER_STASH_GIT_PASSWORD=bar\n      - WOODPECKER_STASH_CONSUMER_KEY=95c0282573633eb25e82\n+     - WOODPECKER_STASH_CONSUMER_RSA=/etc/bitbucket/key.pem\n      - WOODPECKER_STASH_URL=http://stash.mycompany.com\n+  volumes:\n+     - /etc/bitbucket/key.pem:/etc/bitbucket/key.pem\n\n  woodpecker-agent:\n    [...]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Private key as environment variable"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-diff",children:"# docker-compose.yml\nversion: '3'\n\nservices:\n  woodpecker-server:\n    [...]\n    environment:\n      - [...]\n      - WOODPECKER_STASH=true\n      - WOODPECKER_STASH_GIT_USERNAME=foo\n      - WOODPECKER_STASH_GIT_PASSWORD=bar\n      - WOODPECKER_STASH_CONSUMER_KEY=95c0282573633eb25e82\n+     - WOODPECKER_STASH_CONSUMER_RSA_STRING=contentOfPemKeyAsString\n      - WOODPECKER_STASH_URL=http://stash.mycompany.com\n\n  woodpecker-agent:\n    [...]\n"})}),"\n",(0,r.jsx)(n.h2,{id:"service-account",children:"Service Account"}),"\n",(0,r.jsxs)(n.p,{children:["Woodpecker uses ",(0,r.jsx)(n.code,{children:"git+https"})," to clone repositories, however, Bitbucket Server does not currently support cloning repositories with oauth token. To work around this limitation, you must create a service account and provide the username and password to Woodpecker. This service account will be used to authenticate and clone private repositories."]}),"\n",(0,r.jsx)(n.h2,{id:"registration",children:"Registration"}),"\n",(0,r.jsxs)(n.p,{children:["You must register your application with Bitbucket Server in order to generate a consumer key. Navigate to your account settings and choose Applications from the menu, and click Register new application. Now copy & paste the text value from ",(0,r.jsx)(n.code,{children:"/etc/bitbucket/key.pub"})," into the ",(0,r.jsx)(n.code,{children:"Public Key"})," in the incoming link part of the application registration."]}),"\n",(0,r.jsxs)(n.p,{children:["Please use ",(0,r.jsx)(n.a,{href:"http://woodpecker.mycompany.com/authorize",children:"http://woodpecker.mycompany.com/authorize"})," as the Authorization callback URL."]}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.p,{children:"This is a full list of configuration options. Please note that many of these options use default configuration values that should work for the majority of installations."}),"\n",(0,r.jsx)(n.h3,{id:"woodpecker_stash",children:(0,r.jsx)(n.code,{children:"WOODPECKER_STASH"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Default: ",(0,r.jsx)(n.code,{children:"false"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Enables the Bitbucket Server driver."}),"\n",(0,r.jsx)(n.h3,{id:"woodpecker_stash_url",children:(0,r.jsx)(n.code,{children:"WOODPECKER_STASH_URL"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Default: empty"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Configures the Bitbucket Server address."}),"\n",(0,r.jsx)(n.h3,{id:"woodpecker_stash_consumer_key",children:(0,r.jsx)(n.code,{children:"WOODPECKER_STASH_CONSUMER_KEY"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Default: empty"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Configures your Bitbucket Server consumer key."}),"\n",(0,r.jsx)(n.h3,{id:"woodpecker_stash_consumer_rsa",children:(0,r.jsx)(n.code,{children:"WOODPECKER_STASH_CONSUMER_RSA"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Default: empty"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Configures the path to your Bitbucket Server private key file."}),"\n",(0,r.jsx)(n.h3,{id:"woodpecker_stash_consumer_rsa_string",children:(0,r.jsx)(n.code,{children:"WOODPECKER_STASH_CONSUMER_RSA_STRING"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Default: empty"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Configures your Bitbucket Server private key."}),"\n",(0,r.jsx)(n.h3,{id:"woodpecker_stash_git_username",children:(0,r.jsx)(n.code,{children:"WOODPECKER_STASH_GIT_USERNAME"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Default: empty"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This username is used to authenticate and clone all private repositories."}),"\n",(0,r.jsx)(n.h3,{id:"woodpecker_stash_git_password",children:(0,r.jsx)(n.code,{children:"WOODPECKER_STASH_GIT_PASSWORD"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Default: empty"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The password is used to authenticate and clone all private repositories."}),"\n",(0,r.jsx)(n.h3,{id:"woodpecker_stash_skip_verify",children:(0,r.jsx)(n.code,{children:"WOODPECKER_STASH_SKIP_VERIFY"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Default: ",(0,r.jsx)(n.code,{children:"false"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Configure if SSL verification should be skipped."})]})}function u(e={}){const{wrapper:n}={...(0,o.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},38088:(e,n,t)=>{var r=t(96651),o=Symbol.for("react.element"),i=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function d(e,n,t){var r,i={},d=null,l=null;for(r in void 0!==t&&(d=""+t),void 0!==n.key&&(d=""+n.key),void 0!==n.ref&&(l=n.ref),n)s.call(n,r)&&!a.hasOwnProperty(r)&&(i[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===i[r]&&(i[r]=n[r]);return{$$typeof:o,type:e,key:d,ref:l,props:i,_owner:c.current}}n.Fragment=i,n.jsx=d,n.jsxs=d},2488:(e,n,t)=>{e.exports=t(38088)},37052:(e,n,t)=>{t.d(n,{I:()=>c,M:()=>s});var r=t(96651);const o={},i=r.createContext(o);function s(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);