"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([["1105"],{1178:function(e,s,n){n.r(s),n.d(s,{default:()=>h,frontMatter:()=>a,metadata:()=>t,assets:()=>l,toc:()=>c,contentTitle:()=>o});var t=JSON.parse('{"id":"usage/secrets","title":"Secrets","description":"Woodpecker provides the ability to store named parameters external to the YAML configuration file, in a central secret store. These secrets can be passed to individual steps of the pipeline at runtime.","source":"@site/versioned_docs/version-2.8/20-usage/40-secrets.md","sourceDirName":"20-usage","slug":"/usage/secrets","permalink":"/docs/usage/secrets","draft":false,"unlisted":false,"editUrl":"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/versioned_docs/version-2.8/20-usage/40-secrets.md","tags":[],"version":"2.8","sidebarPosition":40,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Matrix workflows","permalink":"/docs/usage/matrix-workflows"},"next":{"title":"Registries","permalink":"/docs/usage/registries"}}'),r=n("96773"),i=n("24027");let a={},o="Secrets",l={},c=[{value:"Usage",id:"usage",level:2},{value:"Use secrets in commands",id:"use-secrets-in-commands",level:3},{value:"Use secrets in settings and environment",id:"use-secrets-in-settings-and-environment",level:3},{value:"Note about parameter pre-processing",id:"note-about-parameter-pre-processing",level:3},{value:"Use in Pull Requests events",id:"use-in-pull-requests-events",level:3},{value:"Image filter",id:"image-filter",level:2},{value:"Adding Secrets",id:"adding-secrets",level:2},{value:"CLI Examples",id:"cli-examples",level:3}];function d(e){let s={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"secrets",children:"Secrets"})}),"\n",(0,r.jsx)(s.p,{children:"Woodpecker provides the ability to store named parameters external to the YAML configuration file, in a central secret store. These secrets can be passed to individual steps of the pipeline at runtime."}),"\n",(0,r.jsx)(s.p,{children:"Woodpecker provides three different levels to add secrets to your pipeline. The following list shows the priority of the different levels. If a secret is defined in multiple levels, will be used following this priorities: Repository secrets > Organization secrets > Global secrets."}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Repository secrets"}),": They are available to all pipelines of an repository."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Organization secrets"}),": They are available to all pipelines of an organization."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Global secrets"}),": Can be configured by an instance admin.\nThey are available to all pipelines of the ",(0,r.jsx)(s.strong,{children:"whole"})," Woodpecker instance and should therefore ",(0,r.jsx)(s.strong,{children:"only"})," be used for secrets that are allowed to be read by ",(0,r.jsx)(s.strong,{children:"all"})," users."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(s.h3,{id:"use-secrets-in-commands",children:"Use secrets in commands"}),"\n",(0,r.jsx)(s.admonition,{type:"warning",children:(0,r.jsxs)(s.p,{children:["The use of secrets is deprecated as of version 2.8 and planned to be removed with version 3.\nInstead, you can use the ",(0,r.jsx)(s.em,{children:"secrets in settings and environment"})," approach outlined below.\nYou can already migrate to this strategy with version 2.8."]})}),"\n",(0,r.jsxs)(s.p,{children:["Secrets are exposed to your pipeline steps and plugins as uppercase environment variables and can therefore be referenced in the commands section of your pipeline,\nonce their usage is declared in the ",(0,r.jsx)(s.code,{children:"secrets"})," section:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" steps:\n   - name: docker\n     image: docker\n     commands:\n+      - echo $docker_username\n+      - echo $DOCKER_PASSWORD\n+    secrets: [ docker_username, DOCKER_PASSWORD ]\n"})}),"\n",(0,r.jsxs)(s.p,{children:["The case of the environment variables is not changed, but secret matching is done case-insensitively. In the example above, ",(0,r.jsx)(s.code,{children:"DOCKER_PASSWORD"})," would also match if the secret is called ",(0,r.jsx)(s.code,{children:"docker_password"}),"."]}),"\n",(0,r.jsx)(s.h3,{id:"use-secrets-in-settings-and-environment",children:"Use secrets in settings and environment"}),"\n",(0,r.jsxs)(s.p,{children:["You can set a setting or environment value from secrets using the ",(0,r.jsx)(s.code,{children:"from_secret"})," syntax."]}),"\n",(0,r.jsxs)(s.p,{children:["The example below passes a secret called ",(0,r.jsx)(s.code,{children:"secret_token"})," as an environment variable that will be called ",(0,r.jsx)(s.code,{children:"TOKEN_ENV"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:' steps:\n   env-secret-example:\n     image: alpine\n     commands:\n+      - echo "The secret is $TOKEN_ENV"\n+    environment:\n+      TOKEN_ENV:\n+        from_secret: secret_token\n'})}),"\n",(0,r.jsxs)(s.p,{children:["You can use the same syntax to pass secrets to settings. For example, you can pass a secret named ",(0,r.jsx)(s.code,{children:"secret_token"})," to the settings called ",(0,r.jsx)(s.code,{children:"token"}),", which will then be available in the plugin as environment variable named ",(0,r.jsx)(s.code,{children:"PLUGIN_TOKEN"})," (See ",(0,r.jsx)(s.a,{href:"/docs/usage/plugins/creating-plugins#settings",children:"plugins"})," for details)."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" steps:\n   - name: settings-secret-example\n     image: my-plugin\n+    settings:\n+      token:\n+        from_secret: secret_token\n"})}),"\n",(0,r.jsx)(s.h3,{id:"note-about-parameter-pre-processing",children:"Note about parameter pre-processing"}),"\n",(0,r.jsx)(s.p,{children:"Please note parameter expressions are subject to pre-processing. When using secrets in parameter expressions they should be escaped."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" steps:\n   - name: docker\n     image: docker\n     commands:\n-      - echo ${docker_username}\n-      - echo ${DOCKER_PASSWORD}\n+      - echo $${docker_username}\n+      - echo $${DOCKER_PASSWORD}\n     secrets: [ docker_username, DOCKER_PASSWORD ]\n"})}),"\n",(0,r.jsx)(s.h3,{id:"use-in-pull-requests-events",children:"Use in Pull Requests events"}),"\n",(0,r.jsxs)(s.p,{children:["Secrets are not exposed to pull requests by default. You can override this behavior by creating the secret and enabling the ",(0,r.jsx)(s.code,{children:"pull_request"})," event type, either in UI or by CLI, see below."]}),"\n",(0,r.jsx)(s.admonition,{type:"note",children:(0,r.jsx)(s.p,{children:"Please be careful when exposing secrets to pull requests. If your repository is open source and accepts pull requests your secrets are not safe. A bad actor can submit a malicious pull request that exposes your secrets."})}),"\n",(0,r.jsx)(s.h2,{id:"image-filter",children:"Image filter"}),"\n",(0,r.jsx)(s.p,{children:"To prevent abusing your secrets from malicious usage, you can limit a secret to a list of images. If enabled they are not available to any other plugin (steps without user-defined commands). If you or an attacker defines explicit commands, the secrets will not be available to the container to prevent leaking them."}),"\n",(0,r.jsx)(s.h2,{id:"adding-secrets",children:"Adding Secrets"}),"\n",(0,r.jsx)(s.p,{children:"Secrets are added to the Woodpecker in the UI or with the CLI."}),"\n",(0,r.jsx)(s.h3,{id:"cli-examples",children:"CLI Examples"}),"\n",(0,r.jsx)(s.p,{children:"Create the secret using default settings. The secret will be available to all images in your pipeline, and will be available to all push, tag, and deployment events (not pull request events)."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"woodpecker-cli secret add \\\n  -repository octocat/hello-world \\\n  -name aws_access_key_id \\\n  -value <value>\n"})}),"\n",(0,r.jsx)(s.p,{children:"Create the secret and limit to a single image:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" woodpecker-cli secret add \\\n   -repository octocat/hello-world \\\n+  -image plugins/s3 \\\n   -name aws_access_key_id \\\n   -value <value>\n"})}),"\n",(0,r.jsx)(s.p,{children:"Create the secrets and limit to a set of images:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" woodpecker-cli secret add \\\n   -repository octocat/hello-world \\\n+  -image plugins/s3 \\\n+  -image peloton/woodpecker-ecs \\\n   -name aws_access_key_id \\\n   -value <value>\n"})}),"\n",(0,r.jsx)(s.p,{children:"Create the secret and enable for multiple hook events:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" woodpecker-cli secret add \\\n   -repository octocat/hello-world \\\n   -image plugins/s3 \\\n+  -event pull_request \\\n+  -event push \\\n+  -event tag \\\n   -name aws_access_key_id \\\n   -value <value>\n"})}),"\n",(0,r.jsxs)(s.p,{children:["Loading secrets from file using curl ",(0,r.jsx)(s.code,{children:"@"})," syntax. This is the recommended approach for loading secrets from file to preserve newlines:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-diff",children:" woodpecker-cli secret add \\\n   -repository octocat/hello-world \\\n   -name ssh_key \\\n+  -value @/root/ssh/id_rsa\n"})})]})}function h(e={}){let{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},24027:function(e,s,n){n.d(s,{Z:function(){return o},a:function(){return a}});var t=n(41699);let r={},i=t.createContext(r);function a(e){let s=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);